
# The ``make_model`` Program

## Synopsis

``make_model [options] <input_file> output_file``

## Description

This program reads an image in PNM/PGM/PPM format from
standard input, generates a mesh model in MODEL (Header + OFF) format,
and writes the model to standard output. The ``make_model`` program
consists of three main functional blocks: the initial mesh generation
block, the mesh simplification block, and a postprocessing block.
The initial mesh-generation block will select the initial mesh points
based on the specified initial generator (i.e., ``all``, ``random``,
``ed``). The mesh simplification block will remove sample points from
the mesh until the desired mesh size is achieve. The postprocessing
block provides the ability to keep removing points if this will reduce
the overall approximation error. In order to run the ``make_model``
program, an image in PNM/PPM/PGM format must be specified from standard
input, and the desired sampling density (or size, or error) must be
specified by the option ``--density`` (or ``--size `` or ``--error``).

Note: by default, the initial mesh density is 100%. User can specify the
initial density (or size) through the option:
``--initial-density`` (or ``--initial-size``, or
 ``--relative-initial-density``).



### Details of Each Command Line Option

**NOTE**: if an option has a default value, the default value is
shown in the round bracket after the option.
e.g., ``--debug-level $arg (=0)`` means ``$arg`` has a default value ``0``.

Options:

  ``-h [ --help ] ``<br />
  Print a help message listing all free parameters and valid arguments for
  each parameter.

  ``--debug-level arg (=0)``<br />
  Set debug level.

  ``--history-file $arg ``<br />
  Set history file.

  ``--history-level $arg (=0) ``<br />
  Set history level.

  ``--density $arg``<br />
  Specify the target mesh sampling density (in percent).

  ``--size $arg``<br />
  Specify target mesh size (in number of samples).

  ``--error $arg``  <br />
  Specify target mesh error threshold.

  ``--relative-initial-density $arg``<br />
  Set the initial density that relative to the target density. This will set
  the initial mesh density as ``$arg / (density * 100)``.

  ``--initial-density $arg (=100)``<br />
  Set initial mesh density (in percent).

  ``--initial-size $arg``<br />
  Specify initial mesh size (in number of samples).

  ``--mesh-generation-policy $arg (=mcmg)``<br />
  Specify the method used for generating the mesh.
  Note: This option can take influence only when the input image is a
  color image.
  Valid values for ``$arg`` are:
  * ``mcmg`` : multi component mesh generation. This will process multiple
  components together by using the color image mesh generator.
  * ``lsmg`` : luma space mesh generation. This will convert the color
  image into luma space first, then call the grayscale image mesh generator
  to get a mesh, finally replace all sample point values with color values
  in the mesh.


  ``--initial-generator $arg (=ed) ``<br />
  Specify the method used for generating initial mesh point set.
  Valid values for ``$arg`` are:
  * ``all``: set all sample points on the sampling grid as the initial
  point set.
  * ``random``: randomly select points on the sampling grid as the initial
  point set.
  * ``uniform``: uniformly select points on the sampling grid as the
  initial point set.
  * ``ed ``: Use error diffusion method to select the initial point set.


  ``--ed-size-tolerance $arg (=10) ``<br />
  Specify the size tolerance of the mesh that generated by the error
  diffusion method.

  ``--smooth-order $arg (=3)  ``<br />
  Specify the smooth order of the smoothing filter.
  The smooth order must be a positive odd integer value.
  If one, no smoothing will be applied.
  NOTE: This option can take influence only when the ``initial-generator``
  is ``ed``. <br>


  ``--smooth-operator $arg (=binomial) ``<br />
  Specify the smoothing operator. Note: this option can take influence only
  when the ``initial-generator`` is ``ed``.
  Valid values for ``$arg`` are:
  * ``binomial``: use binomial filter.
  * ``mean``: use mean filter.


  ``--smooth-direction arg (=both) ``<br />
  Specify the smoothing direction. Note: this option can take influence only
  when the ``initial-generator`` is ``ed``.
  Valid values for ``$arg`` are:
  * ``orthogonal``: smooth on orthogonal direction.
  * ``both``: smooth on both horizontal and vertical directions.


  ``--smooth-bound-policy arg (=zero_ext)``<br />
   Specify the boundary handling policy used for smoothing.
   NOTE: This option can take influence only when the ``initial-generator``
   is ``ed``.
   Valid values for ``$arg`` are:
  * ``zero_ext``: zero extension.
  * ``const_ext``: constant extension.
  * ``sym_ext``: symmetric extension.


  ``--derivative-bound-policy $arg (=zero_ext)``<br />
  Specify the boundary handling policy used for partial derivative
  computation. NOTE: This option can take influence only when the
  ``initial-generator`` is ``ed``.
  Valid values for ``$args`` are:
  * ``zero_ext``: zero extension.
  * ``const_ext``: constant extension.
  * ``sym_ext``: symmetric extension.


  ``--use-double-convolution $arg (=0)``<br />
  Specify if do smoothing and derivative operations together in
  one convolution or saperately in two convolution.
  NOTE: This option can take influence only when the  ``initial-generator``
  is ``ed``.
  Valid values for ``$args`` are:

  * ``0``: the program will do smoothing and derivative operations in
   a single convolution. The boundary policy will be based on the option
  derivative-bound-policy at this time.
  * ``1``: the program will compute the partial derivative by using two
  convolution operations. Basically it will smooth the image first using one
  convolution and then do another convolution with derivative filters.



  ``--ed-strategy $arg (=max_comp_mmsodd_ed)``<br />
  Specify the error diffusion strategy.
  If the input image is a color image, each of the valid values
  corresponds to a color image error diffusion strategy shown below;
  If the input image is a grayscale image, if ``$arg`` is set as one of
  ``gray_comp_laplacian_ed``, ``mean_comp_laplacian_ed``, or
  ``max_comp_laplacian_ed``, the program will use laplacian of the image
  as the density function for the error diffusion algorithm; otherwise,
  the program will use MMSODD of the image as the density function.
  Valid values for ``$arg`` are:

  * `` gray_comp_mmsodd_ed ``: convert the color image to a grayscale
   image first, then use mmsodd of the grayscale image as the density
  function and run Floyd-steinberg error diffusion method.
  * ``gray_comp_laplacian_ed``: convert the color image to a grayscale
   image first, then use laplacian of the grayscale image as the density
  function and run Floyd-steinberg error diffusion method.
  * ``vector_space_comb``: compute the maximum directional gradient of the
  vector space of R,G,B components as the density function and run
  Floyd-steinberg error diffusion method.
  * ``max_comp_mmsodd_ed``: compute the max mmsodd of all components as
   the density function and run Floyd-steinberg error diffusion method.
  * ``mean_comp_mmsodd_ed``: compute the mean mmsodd of all components
   as the density function and run Floyd-steinberg error diffusion method.
  * `` max_comp_laplacian_ed ``: compute the max laplacian of all
  components as the density function and run Floyd-steinberg error
  diffusion method.
  * ``mean_comp_laplacian_ed ``: compute the mean laplacian of all
  components as the density function and run Floyd-steinberg error
  diffusion method.
  * ``three_comps_union_mmsodd``: compute mmsodd of each component
  separately and take as three density functions; and run Floyd-steinberg
  error diffusion method on each of R,G,B components and get the union
  set. The result mesh will have desired number of points.
  * ``three_comps_union_laplacian``: compute laplacian of each component
  separately and take as three density functions; and run Floyd-steinberg
  error diffusion method on each of R,G,B components and get the union set.
  The result mesh will have desired number of points.


  ``--ed-scan-order $arg (=serpentine) ``<br />
  Specify the error diffusion scan order.
  Valid values for ``$arg`` are:
  * ``raster``: raster scan order.
  * ``serpentine``: serpentine scan order.


  ``--ed-leaky-mode $arg (=no_leaky) ``<br />
  Specify the leaky mode for error diffusion.
  Valid values for ``$arg`` are:
  * ``leaky``: leaky mode.
  * ``no_leaky``: no_leaky mode.


  ``--ed-initial-error-mode $arg (=mirror)``<br />
  Specify the initial error mode for error diffusion.
  Valid values for ``$arg`` are:
  * ``zero``: initial errors are all zero.
  * ``random ``: initial errors are randomly generated.
  * ``mirror``: initial errors are based on doing Floyd-steinberg error
  diffusion first on the mirror image of the original image. Then take the
  diffused errors on the last row as the initial errors.


  ``--error-metric $arg (=mean_comp_se) ``<br />
  Specify the error metric used to compute face error.
  Valid values for ``$arg`` are:
  * ``mean_comp_se``: mean squared error of all components.
  * `` mean_comp_ae ``: mean absolute error of all components.
  * ``luma_se ``: luma space squared error.
  * ``luma_ae``: luma space absolute error.
  * ``ycbcr_vec_se``: YCbCr vector space squared error.
  * ``ycbcr_vec_ae ``: YCbCr vector space absolute error.
  * ``vec_se``: vector absolute error.


  ``--bad-point-removal $arg (=1)  ``<br />
  Specify if to enable bad point removal or not.
  Valid values for ``$arg`` are:
  * ``0``: not enable bad point removal.
  * ``1``: enable bad point removel.


  ### Some Usage Examples:

  1) Use the MED method to generate the mesh for a grayscale or rgb image:

```
      make_model <input_image.pnm> output_model.model
      --density 2 --initial-density 2 --initial-generator ed \
      --bad-point-removal 1 --ed-strategy-error-mode mirror \
      --ed-strategy max_comp_mmsodd_ed
```

  2) Use the MGPRFS method to generate the mesh for a grayscale or rgb image:

  ```
     make_model <input_image.pnm> output_model.model \
      --density 2 --relative-initial-density 400 --initial-generator ed \
      --bad-point-removal 0 --ed-initial-error-mode mirror \
      --ed-strategy max_comp_mmsodd_ed
  ```

  3) Use the ED method to generate a mesh for a grayscale image:

  ```
      make_model <input_image.pnm> output_model.model \
      --density 2 --initial-density 2 --initial-generator ed \
      --bad-point-removal 0 --ed-initial-error-mode zero
  ```

  4) Use the GPR method to generate the mesh for a grayscale image:

  ```
     make_model <input_image.pnm> output_model.model \
      --density 2 --initial-density 100 --initial-generator all \
      --bad-point-removal 0
  ```

  5) use the GPRFS-ED method to generate the mesh for a grayscale image:

  ```
      make_model <input_image.pnm> output_model.model \
      --density 2 --relative-initial-density 400 --initial-generator ed \
      --bad-point-removal 0 --ed-initial-error-mode zero
  ```

# The ``rasterize_model`` Program
## Synopsis
``rasterize_model <input_file> output_file``

### Description
The ``rasterize_model`` program is used to reconstruct an image from
a mesh model. The program reads a mesh model from standard input,
reconstructs an image from the mesh model, and writes the image to standard
output. The reconstructed image is written in PGM/PNM format for grayscale
images, and in PPM/PNM format for color images.
